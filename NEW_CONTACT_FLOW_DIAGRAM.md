# New Contact Creation Flow - Visual Diagram

## Component Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AccountPage.jsx                            â”‚
â”‚                    (accountId = 5)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ActivityQuickActions.jsx                           â”‚
â”‚              entity={account}, entityType="account"             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NewTaskModal.jsx                             â”‚
â”‚              defaultValues={{ relatedTo: account }}             â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              NameLookup Component                         â”‚ â”‚
â”‚  â”‚              accountId={5}                                â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚           Lookup Component                          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  showCreateNew={true}                               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  onCreateNew={handleCreateNew}                      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  [Search contacts...]                               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ ðŸ‘¤ John Doe                                 â”‚   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ ðŸ‘¤ Jane Smith                               â”‚   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ âŠ•  New Contact                              â”‚â—„â”€â”€â”¼â”€â”¼â”€â”¼â”€ Click!
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚        NewContactModal Component                    â”‚ â”‚ â”‚
â”‚  â”‚  â”‚        isOpen={true}                                â”‚ â”‚ â”‚
â”‚  â”‚  â”‚        defaultAccountId={5}                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚        onContactCreated={handleContactCreated}      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚     NewContactForm                            â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                                               â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  First Name: [_____________]                  â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  Last Name:  [_____________]                  â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  Email:      [_____________]                  â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  Account:    [Swiss â–¼] (disabled)            â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                                               â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  [Cancel]  [Create Contact]                   â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Sequence Diagram

```
User          NameLookup      Lookup      NewContactModal    API         Database
 â”‚                â”‚             â”‚               â”‚             â”‚              â”‚
 â”‚  Click Name    â”‚             â”‚               â”‚             â”‚              â”‚
 â”‚  field         â”‚             â”‚               â”‚             â”‚              â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚               â”‚             â”‚              â”‚
 â”‚                â”‚  Show       â”‚               â”‚             â”‚              â”‚
 â”‚                â”‚  dropdown   â”‚               â”‚             â”‚              â”‚
 â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚             â”‚              â”‚
 â”‚                â”‚             â”‚  Fetch        â”‚             â”‚              â”‚
 â”‚                â”‚             â”‚  contacts     â”‚             â”‚              â”‚
 â”‚                â”‚             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                â”‚             â”‚               â”‚             â”‚              â”‚
 â”‚                â”‚             â”‚  Display      â”‚             â”‚              â”‚
 â”‚                â”‚             â”‚  results +    â”‚             â”‚              â”‚
 â”‚                â”‚             â”‚  "New Contact"â”‚             â”‚              â”‚
 â”‚                â”‚             â”‚               â”‚             â”‚              â”‚
 â”‚  Click "New    â”‚             â”‚               â”‚             â”‚              â”‚
 â”‚  Contact"      â”‚             â”‚               â”‚             â”‚              â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚             â”‚              â”‚
 â”‚                â”‚             â”‚  onCreateNew()â”‚             â”‚              â”‚
 â”‚                â”‚             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚              â”‚
 â”‚                â”‚             â”‚               â”‚             â”‚              â”‚
 â”‚                â”‚  handleCreateNew()          â”‚             â”‚              â”‚
 â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚              â”‚
 â”‚                â”‚             â”‚               â”‚             â”‚              â”‚
 â”‚                â”‚  Open modal â”‚               â”‚             â”‚              â”‚
 â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚              â”‚
 â”‚                â”‚             â”‚               â”‚             â”‚              â”‚
 â”‚                â”‚             â”‚               â”‚  Render     â”‚              â”‚
 â”‚                â”‚             â”‚               â”‚  form with  â”‚              â”‚
 â”‚                â”‚             â”‚               â”‚  account=5  â”‚              â”‚
 â”‚                â”‚             â”‚               â”‚             â”‚              â”‚
 â”‚  Fill form     â”‚             â”‚               â”‚             â”‚              â”‚
 â”‚  & submit      â”‚             â”‚               â”‚             â”‚              â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚              â”‚
 â”‚                â”‚             â”‚               â”‚  POST       â”‚              â”‚
 â”‚                â”‚             â”‚               â”‚  /contacts/ â”‚              â”‚
 â”‚                â”‚             â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚              â”‚
 â”‚                â”‚             â”‚               â”‚             â”‚  INSERT      â”‚
 â”‚                â”‚             â”‚               â”‚             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                â”‚             â”‚               â”‚             â”‚              â”‚
 â”‚                â”‚             â”‚               â”‚             â”‚  New contact â”‚
 â”‚                â”‚             â”‚               â”‚             â”‚  (id=42)     â”‚
 â”‚                â”‚             â”‚               â”‚             â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚                â”‚             â”‚               â”‚  Response   â”‚              â”‚
 â”‚                â”‚             â”‚               â”‚  {id:42,... }              â”‚
 â”‚                â”‚             â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
 â”‚                â”‚             â”‚               â”‚             â”‚              â”‚
 â”‚                â”‚  onContactCreated(contact)  â”‚             â”‚              â”‚
 â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚              â”‚
 â”‚                â”‚             â”‚               â”‚             â”‚              â”‚
 â”‚                â”‚  Add to     â”‚               â”‚             â”‚              â”‚
 â”‚                â”‚  selection  â”‚               â”‚             â”‚              â”‚
 â”‚                â”‚  array      â”‚               â”‚             â”‚              â”‚
 â”‚                â”‚             â”‚               â”‚             â”‚              â”‚
 â”‚  See new       â”‚             â”‚               â”‚             â”‚              â”‚
 â”‚  contact       â”‚             â”‚               â”‚             â”‚              â”‚
 â”‚  selected      â”‚             â”‚               â”‚             â”‚              â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚               â”‚             â”‚              â”‚
 â”‚                â”‚             â”‚               â”‚             â”‚              â”‚
```

## State Flow

### Initial State
```javascript
// NameLookup state
{
  entityType: 'contact',
  currentSelection: null,
  isNewContactModalOpen: false,
  value: []  // No contacts selected yet
}
```

### After Clicking "New Contact"
```javascript
// NameLookup state
{
  entityType: 'contact',
  currentSelection: null,
  isNewContactModalOpen: true,  // â† Modal opens
  value: []
}
```

### After Creating Contact
```javascript
// API Response
{
  id: 42,
  first_name: "Rudolf",
  last_name: "Ralfi",
  email: "rudolf@swiss.com",
  account_id: 5,
  account: { id: 5, name: "Swiss" }
}

// NameLookup state
{
  entityType: 'contact',
  currentSelection: null,
  isNewContactModalOpen: false,  // â† Modal closes
  value: [
    {
      id: 42,
      first_name: "Rudolf",
      last_name: "Ralfi",
      email: "rudolf@swiss.com",
      account_id: 5,
      account: { id: 5, name: "Swiss" },
      entityType: 'contact'  // â† Added by NameLookup
    }
  ]
}
```

## Props Cascade

```
AccountPage
  accountId: 5
    â†“
ActivityQuickActions
  entity: { id: 5, name: "Swiss", ... }
  entityType: "account"
    â†“
NewTaskModal
  defaultValues: {
    relatedTo: { id: 5, name: "Swiss", entityType: "account" }
  }
    â†“
NameLookup
  accountId: 5  â† Extracted from relatedTo
  value: []
  onChange: (contacts) => setFormData({...formData, name: contacts})
    â†“
Lookup
  apiEndpoint: "/contacts/"
  additionalFilters: { account_id: 5 }
  showCreateNew: true
  createNewLabel: "New Contact"
  onCreateNew: () => setIsNewContactModalOpen(true)
    â†“
NewContactModal
  isOpen: true
  defaultAccountId: 5
  onContactCreated: (contact) => {
    onChange([...value, { ...contact, entityType: 'contact' }])
  }
    â†“
NewContactForm
  defaultAccountId: 5
  onSubmit: (data) => createContact({ ...data, account_id: 5 })
```

## API Call Details

### Search Contacts (Initial)
```http
GET /contacts/?account_id=5
Authorization: Bearer <token>

Response:
[
  { id: 10, first_name: "John", last_name: "Doe", account_id: 5 },
  { id: 15, first_name: "Jane", last_name: "Smith", account_id: 5 }
]
```

### Create New Contact
```http
POST /contacts/
Authorization: Bearer <token>
Content-Type: application/json

{
  "first_name": "Rudolf",
  "last_name": "Ralfi",
  "title": "Mr",
  "email": "rudolf@swiss.com",
  "phone": "+41 123 456 789",
  "account_id": 5,
  "reports_to": null,
  "description": ""
}

Response:
{
  "id": 42,
  "first_name": "Rudolf",
  "last_name": "Ralfi",
  "title": "Mr",
  "email": "rudolf@swiss.com",
  "phone": "+41 123 456 789",
  "account_id": 5,
  "account": {
    "id": 5,
    "name": "Swiss"
  },
  "reports_to": null,
  "description": "",
  "created_at": "2025-01-15T10:30:00Z",
  "updated_at": "2025-01-15T10:30:00Z"
}
```

## Key Features

1. **Context Awareness** - Account ID flows from page â†’ modal â†’ form
2. **Automatic Selection** - New contact immediately added to task
3. **Cache Invalidation** - React Query refreshes contact list
4. **Disabled Field** - Account dropdown locked when pre-filled
5. **Seamless UX** - No page navigation required
